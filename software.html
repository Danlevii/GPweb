<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Software General | GP Graders</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root{
      --bg0:#070e18;
      --bg2:#0f1e33;
      --panel: rgba(255,255,255,.04);
      --stroke: rgba(255,255,255,.10);
      --text:#eaf1ff;
      --muted:#b9c6e3;
      --brand:#4da3ff;
      --brand2:#38d4ff;
      --shadow: 0 16px 50px rgba(0,0,0,.45);
      --r20:20px;
      --card: rgba(255,255,255,.04); 
      --r: 16px;                    
    }


    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(77,163,255,.18), transparent 60%),
        radial-gradient(900px 600px at 80% 90%, rgba(77,163,255,.10), transparent 55%),
        linear-gradient(135deg, var(--bg0), var(--bg2));
    }

    header{
      position:sticky;
      top:0;
      background:rgba(8,14,24,.9);
      border-bottom:1px solid rgba(255,255,255,.08);
      z-index:10;
    }

    header .wrap{
      max-width:1100px;
      margin:auto;
      padding:14px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    header h1{
      margin:0;
      font-size:16px;
    }

    header span{
      font-size:12px;
      color:var(--muted);
    }

    .btn{
      padding:9px 14px;
      border-radius:12px;
      text-decoration:none;
      font-weight:700;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:var(--text);
    }

    .btn.primary{
  border-color: rgba(77,163,255,.55);
  background: linear-gradient(180deg, rgba(77,163,255,.18), rgba(56,212,255,.12));
}
.btn.primary:hover{
  border-color: rgba(77,163,255,.85);
}

    main{
      max-width:1100px;
      margin:auto;
      padding:26px 18px 50px;
    }

    .section{
      margin-top:40px;
    }

    .section-title{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:8px;
    }

    .bar{
      width:10px;
      height:22px;
      border-radius:8px;
      background:linear-gradient(180deg,var(--brand),var(--brand2));
    }

    .section-title h2{
      margin:0;
      font-size:18px;
    }

    .section-sub{
      font-size:13px;
      color:var(--muted);
      margin-bottom:18px;
      max-width:850px;
    }

    .figure{
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:var(--r20);
      box-shadow:var(--shadow);
      margin-bottom:20px;
    }

    .figure-h{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }

    .figure-h h3{
      margin:0;
      font-size:14px;
    }

    .figure-h .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }

    .ph{
      height:220px;
      margin:14px 16px;
      border-radius:16px;
      border:2px dashed rgba(255,255,255,.25);
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-size:12px;
      color:rgba(255,255,255,.6);
    }

    .figure-b{
      padding:0 16px 16px;
      font-size:13px;
      color:var(--muted);
      line-height:1.55;
    }

    footer{
      text-align:center;
      font-size:12px;
      color:rgba(255,255,255,.4);
      padding:20px;
    }

    /* ===== BUSCADOR ===== */
.search-wrap{
  margin-top: 14px;
  background: var(--card);
  border: 1px solid var(--stroke);
  border-radius: var(--r);
  box-shadow: var(--shadow);
  overflow: hidden;
}
.search-head{
  padding: 14px 16px;
  border-bottom: 1px solid rgba(255,255,255,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
}
.search-head h3{
  margin:0;
  font-size: 14px;
}
.search-head .hint{
  margin-top: 4px;
  font-size: 12px;
  color: var(--muted);
}
.search-body{
  padding: 14px 16px 16px;
}
.search-row{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap: wrap;
}
.search-input{
  flex: 1;
  min-width: 220px;
  padding: 12px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.22);
  color: var(--text);
  outline: none;
}
.search-input:focus{
  border-color: rgba(77,163,255,.55);
}
.search-meta{
  margin-top: 10px;
  font-size: 12px;
  color: rgba(230,237,245,.60);
}

/* resaltado */
mark.gp-hit{
  background: rgba(77,163,255,.25);
  border: 1px solid rgba(77,163,255,.35);
  color: var(--text);
  padding: 0 2px;
  border-radius: 6px;
}
mark.gp-hit.active{
  background: rgba(77,163,255,.45);
  border-color: rgba(77,163,255,.75);
  box-shadow: 0 0 0 6px rgba(77,163,255,.14);
}

/* ===== AUTOCOMPLETE LIST ===== */
.search-suggest{
  position: relative;
  flex: 1;
  min-width: 220px;
}
.search-suggest .search-input{
  width: 100%;
}

.suggest-list{
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  right: 0;
  background: rgba(10,20,34,.98);
  border: 1px solid rgba(255,255,255,.14);
  border-radius: 14px;
  box-shadow: 0 18px 60px rgba(0,0,0,.55);
  overflow: hidden;
  z-index: 999;
  max-height: 280px;
  overflow-y: auto;
  display: none;
}

.suggest-item{
  padding: 10px 12px;
  cursor: pointer;
  border-top: 1px solid rgba(255,255,255,.08);
}
.suggest-item:first-child{ border-top: none; }
.suggest-item:hover,
.suggest-item.active{
  background: rgba(77,163,255,.12);
}
.suggest-title{
  font-size: 13px;
  color: rgba(230,237,245,.92);
  line-height: 1.35;
}

.suggest-hi{
  background: rgba(77,163,255,.22);
  border: 1px solid rgba(77,163,255,.35);
  padding: 0 2px;
  border-radius: 6px;
}

  </style>
</head>

<body>

<header>
  <div class="wrap">
    <div>
      <h1>Software General – GP Graders</h1>
      <span>Base común del sistema gpVision™ y Simple GUI</span>
    </div>
    <a href="menu.html" class="btn">⬅ Volver al menú</a>
  </div>
</header>

<main>

  <section class="search-wrap" id="buscador">
  <div class="search-head">
    <div>
      <h3>Búsqueda rápida en el manual</h3>
      <div class="hint">Busca por palabra o frase y salta entre coincidencias</div>
    </div>
    <button class="btn" id="clearSearchBtn" type="button">Limpiar</button>
  </div>

  <div class="search-body">
    <div class="search-row">
      
      <div class="search-suggest">
  <input class="search-input" id="searchInput" type="text" autocomplete="off"
    placeholder="Ej: RTUnit, calibración, carril, licencia...">
  <div class="suggest-list" id="suggestList"></div>
</div>


      <button class="btn primary" id="searchBtn" type="button">Buscar</button>
      <button class="btn" id="prevBtn" type="button">◀</button>
      <button class="btn" id="nextBtn" type="button">▶</button>
    </div>
    <div class="search-meta" id="searchMeta">Sin búsqueda activa.</div>
  </div>
</section>

  <!-- ================================================= -->
  <!-- 1. INTRODUCCIÓN -->
  <!-- ================================================= -->
  <section class="section">
    <div class="section-title">
      <div class="bar"></div>
      <h2>1. Introducción al software general</h2>
    </div>

    <p class="section-sub">
      Visión global del software base que soporta el funcionamiento de gpVision™
      y Simple GUI.
    </p>

    <div class="figure">
      <div class="figure-h">
        <h3>Rol del software en el sistema</h3>
        <div class="hint">Capa lógica común</div>
      </div>
      <div class="ph">IMAGEN / DIAGRAMA GENERAL DEL SOFTWARE</div>
      <div class="figure-b">
        TEXTO A COMPLETAR: explicación del rol del software como núcleo
        de procesamiento, control y comunicación del sistema.
      </div>
    </div>
  </section>

  <!-- ================================================= -->
  <!-- 2. ARQUITECTURA DE SOFTWARE -->
  <!-- ================================================= -->
  <section class="section">
    <div class="section-title">
      <div class="bar"></div>
      <h2>2. Arquitectura de software</h2>
    </div>

    <p class="section-sub">
      Organización interna del software y su interacción con hardware,
      interfaces y base de datos.
    </p>

    <div class="figure">
      <div class="figure-h">
        <h3>Modelo cliente–servidor</h3>
        <div class="hint">Comunicación interna</div>
      </div>
      <div class="ph">DIAGRAMA CLIENTE – SERVIDOR</div>
      <div class="figure-b">
        TEXTO A COMPLETAR: descripción del modelo cliente-servidor
        utilizado por el sistema GP Graders.
      </div>
    </div>

    <div class="figure">
      <div class="figure-h">
        <h3>Comunicación con hardware</h3>
        <div class="hint">PLC, Vision Units y módulos</div>
      </div>
      <div class="ph">IMAGEN DE FLUJO DE COMUNICACIÓN</div>
      <div class="figure-b">
        TEXTO A COMPLETAR: cómo el software intercambia datos
        con los componentes físicos del sistema.
      </div>
    </div>
  </section>

  <!-- ================================================= -->
  <!-- 3. BASE DE DATOS -->
  <!-- ================================================= -->
  <section class="section">
    <div class="section-title">
      <div class="bar"></div>
      <h2>3. Gestión de base de datos</h2>
    </div>

    <p class="section-sub">
      Uso de base de datos para almacenamiento de configuraciones,
      resultados y trazabilidad.
    </p>

    <div class="figure">
      <div class="figure-h">
        <h3>Base de datos SQL Server</h3>
        <div class="hint">Configuración y uso</div>
      </div>
      <div class="ph">IMAGEN DE ESQUEMA DE BASE DE DATOS</div>
      <div class="figure-b">
        TEXTO A COMPLETAR: rol de la base de datos en el sistema,
        tipo de información almacenada y frecuencia de registro.
      </div>
    </div>
  </section>

  <!-- ================================================= -->
  <!-- 4. CONFIGURACIÓN Y SEGURIDAD -->
  <!-- ================================================= -->
  <section class="section">
    <div class="section-title">
      <div class="bar"></div>
      <h2>4. Configuración y seguridad</h2>
    </div>

    <p class="section-sub">
      Gestión de accesos, roles y archivos de configuración del sistema.
    </p>

    <div class="figure">
      <div class="figure-h">
        <h3>Roles de usuario</h3>
        <div class="hint">Administrador y operador</div>
      </div>
      <div class="ph">IMAGEN DE PERFILES DE USUARIO</div>
      <div class="figure-b">
        TEXTO A COMPLETAR: descripción de roles, permisos
        y restricciones del sistema.
      </div>
    </div>
  </section>

  <!-- ================================================= -->
  <!-- 5. REGISTROS Y DIAGNÓSTICO -->
  <!-- ================================================= -->
  <section class="section">
    <div class="section-title">
      <div class="bar"></div>
      <h2>5. Registros y diagnóstico</h2>
    </div>

    <p class="section-sub">
      Herramientas de registro y monitoreo para análisis
      de fallos y comportamiento del sistema.
    </p>

    <div class="figure">
      <div class="figure-h">
        <h3>Logs del sistema</h3>
        <div class="hint">Diagnóstico y trazabilidad</div>
      </div>
      <div class="ph">IMAGEN DE ARCHIVOS DE LOG</div>
      <div class="figure-b">
        TEXTO A COMPLETAR: tipos de registros generados
        y su utilidad para diagnóstico.
      </div>
    </div>
  </section>

</main>

<footer>
  Software General · GP Graders · Documentación técnica interna
</footer>

<script>
  // ====== BUSCADOR + AUTOCOMPLETE ======
  const searchInput = document.getElementById("searchInput");
  const suggestList = document.getElementById("suggestList");
  const searchBtn = document.getElementById("searchBtn");
  const clearBtn = document.getElementById("clearSearchBtn");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const meta = document.getElementById("searchMeta");

  let hits = [];
  let activeIndex = -1;

  // Autocomplete index
  let indexItems = []; // { id, text, el }
  let suggestActive = -1;
  const MAX_SUGGEST = 8;

  const SKIP_TAGS = new Set(["SCRIPT","STYLE","INPUT","TEXTAREA","BUTTON","IFRAME","MARK"]);

  function escapeRegExp(str){
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  }

  function clearMarks(){
    document.querySelectorAll("mark.gp-hit").forEach(m => {
      const t = document.createTextNode(m.textContent);
      m.replaceWith(t);
    });
    hits = [];
    activeIndex = -1;
  }

  function setActive(idx){
    if(!hits.length) return;
    hits.forEach(h => h.classList.remove("active"));
    activeIndex = (idx + hits.length) % hits.length;
    hits[activeIndex].classList.add("active");
    hits[activeIndex].scrollIntoView({ behavior:"smooth", block:"center" });
    meta.textContent = `Coincidencias: ${hits.length} · Mostrando ${activeIndex + 1}/${hits.length}`;
  }

  function highlight(term){
    clearMarks();
    if(!term) {
      meta.textContent = "Sin búsqueda activa.";
      return;
    }

    const root = document.querySelector("main");
    const rx = new RegExp(escapeRegExp(term), "gi");

    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
      acceptNode(node){
        if(!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
        const p = node.parentElement;
        if(!p) return NodeFilter.FILTER_REJECT;
        if(SKIP_TAGS.has(p.tagName)) return NodeFilter.FILTER_REJECT;
        return NodeFilter.FILTER_ACCEPT;
      }
    });

    const nodes = [];
    while(walker.nextNode()) nodes.push(walker.currentNode);

    nodes.forEach(node => {
      const txt = node.nodeValue;
      if(!rx.test(txt)) return;

      rx.lastIndex = 0;
      const frag = document.createDocumentFragment();
      let last = 0;
      let m;

      while((m = rx.exec(txt)) !== null){
        const start = m.index;
        const end = start + m[0].length;

        if(start > last) frag.appendChild(document.createTextNode(txt.slice(last, start)));

        const mark = document.createElement("mark");
        mark.className = "gp-hit";
        mark.textContent = txt.slice(start, end);
        frag.appendChild(mark);

        last = end;
      }

      if(last < txt.length) frag.appendChild(document.createTextNode(txt.slice(last)));

      node.parentNode.replaceChild(frag, node);
    });

    hits = Array.from(document.querySelectorAll("mark.gp-hit"));
    if(hits.length){
      setActive(0);
    }else{
      meta.textContent = "No se encontraron coincidencias.";
    }
  }

  // ====== AUTOCOMPLETE: construir índice del manual ======
  function buildIndex(){
    const root = document.querySelector("main");
    indexItems = [];

    // 1) Títulos y subtítulos (prioridad alta)
    root.querySelectorAll("h1,h2,h3,h4").forEach((el, i) => {
      const t = (el.innerText || "").trim();
      if(t.length >= 3) indexItems.push({ id: `h-${i}`, text: t, el });
    });

    // 2) List items (li) (útiles para pasos)
    root.querySelectorAll("li").forEach((el, i) => {
      const t = (el.innerText || "").trim();
      if(t.length >= 12) indexItems.push({ id: `li-${i}`, text: t.slice(0, 220), el });
    });

    // 3) Párrafos importantes (opcional: recorta)
    root.querySelectorAll(".figure-b p").forEach((el, i) => {
      const t = (el.innerText || "").trim();
      if(t.length >= 18) indexItems.push({ id: `p-${i}`, text: t.slice(0, 220), el });
    });
  }

  // Normaliza para comparar
  function norm(s){
    return (s || "")
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,""); // quita tildes
  }

  function scoreMatch(query, text){
    // scoring simple: incluye, empieza, proximidad
    const q = norm(query);
    const t = norm(text);
    if(!q) return -1;
    const idx = t.indexOf(q);
    if(idx === -1) return -1;

    let score = 0;
    if(idx === 0) score += 6;          // empieza con
    score += Math.max(0, 5 - Math.min(idx, 5)); // mientras más cerca del inicio mejor
    score += Math.min(q.length / 4, 4); // query más larga, mejor
    return score;
  }

  function hiText(text, query){
    const q = query.trim();
    if(!q) return text;
    const rx = new RegExp(escapeRegExp(q), "ig");
    return text.replace(rx, (m)=>`<span class="suggest-hi">${m}</span>`);
  }

  function hideSuggest(){
    suggestList.style.display = "none";
    suggestList.innerHTML = "";
    suggestActive = -1;
  }

function showSuggest(items, query){
  if(!items.length){
    hideSuggest();
    return;
  }
  suggestList.innerHTML = items.map((it, idx) => {
    const line = it.text.length > 120 ? it.text.slice(0, 120) + "…" : it.text;
    return `
      <div class="suggest-item" data-idx="${idx}">
        <div class="suggest-title">${hiText(line, query)}</div>
      </div>
    `;
  }).join("");
  suggestList.style.display = "block";
}

  function getSuggestions(query){
    const q = query.trim();
    if(q.length < 1) return [];

    // filtra y rankea
    const ranked = indexItems
      .map(it => ({ it, s: scoreMatch(q, it.text) }))
      .filter(x => x.s >= 0)
      .sort((a,b) => b.s - a.s)
      .slice(0, MAX_SUGGEST)
      .map(x => x.it);

    return ranked;
  }

  function jumpToElement(el, query){
    if(!el) return;
    // Lleva al elemento
    el.scrollIntoView({ behavior:"smooth", block:"center" });
    // Resalta el término en el documento
    highlight(query);
    // y activa la primera coincidencia visible
    if(hits.length) setActive(0);
    hideSuggest();
  }

  // ====== EVENTOS ======
  buildIndex();

  searchInput?.addEventListener("input", () => {
    const q = searchInput.value;
    const suggestions = getSuggestions(q);
    showSuggest(suggestions, q);
  });

  // click en sugerencias
  suggestList?.addEventListener("click", (e) => {
    const item = e.target.closest(".suggest-item");
    if(!item) return;
    const q = searchInput.value.trim();
    const suggestions = getSuggestions(q);
    const idx = Number(item.dataset.idx);
    const it = suggestions[idx];
    if(it) jumpToElement(it.el, q);
  });

  // navegación teclado (flechas + enter)
  searchInput?.addEventListener("keydown", (e)=>{
    const q = searchInput.value.trim();
    const suggestions = getSuggestions(q);
    if(!suggestions.length) return;

    const items = Array.from(suggestList.querySelectorAll(".suggest-item"));

    if(e.key === "ArrowDown"){
      e.preventDefault();
      suggestActive = (suggestActive + 1) % items.length;
      items.forEach(x => x.classList.remove("active"));
      items[suggestActive].classList.add("active");
      items[suggestActive].scrollIntoView({ block:"nearest" });
    }
    if(e.key === "ArrowUp"){
      e.preventDefault();
      suggestActive = (suggestActive - 1 + items.length) % items.length;
      items.forEach(x => x.classList.remove("active"));
      items[suggestActive].classList.add("active");
      items[suggestActive].scrollIntoView({ block:"nearest" });
    }
    if(e.key === "Enter"){
      // Si hay item activo, salta a ese
      if(suggestActive >= 0 && suggestions[suggestActive]){
        e.preventDefault();
        jumpToElement(suggestions[suggestActive].el, q);
      }else{
        // si no, hace búsqueda normal
        highlight(q);
        hideSuggest();
      }
    }
    if(e.key === "Escape"){
      hideSuggest();
    }
  });

  // click fuera: cerrar lista
  document.addEventListener("click", (e)=>{
    const wrap = e.target.closest(".search-wrap");
    if(!wrap) hideSuggest();
  });

  searchBtn?.addEventListener("click", () => {
    const q = searchInput.value.trim();
    highlight(q);
    hideSuggest();
  });

  nextBtn?.addEventListener("click", ()=> setActive(activeIndex + 1));
  prevBtn?.addEventListener("click", ()=> setActive(activeIndex - 1));

  clearBtn?.addEventListener("click", ()=>{
    searchInput.value = "";
    clearMarks();
    meta.textContent = "Sin búsqueda activa.";
    hideSuggest();
  });
</script>

</body>
</html>
